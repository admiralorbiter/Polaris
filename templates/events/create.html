{% extends "base.html" %}

{% block title %}Create New Event{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>Create New Event</h1>
        <a href="{{ url_for('events_list') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Events
        </a>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Event Information</h5>
                </div>
                <div class="card-body">
                    <form method="POST" id="eventForm">
                        {{ form.hidden_tag() }}

                        <!-- Basic Information -->
                        <h5 class="mb-3">Basic Information</h5>
                        <div class="row">
                            <div class="col-md-8">
                                <div class="form-group mb-3">
                                    {{ form.title.label(class="form-label") }} <span class="text-danger">*</span>
                                    {{ form.title(class="form-control" + (" is-invalid" if form.title.errors else "")) }}
                                    {% if form.title.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.title.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group mb-3">
                                    {{ form.organization_id.label(class="form-label") }} <span class="text-danger">*</span>
                                    {{ form.organization_id(class="form-select" + (" is-invalid" if form.organization_id.errors else "")) }}
                                    {% if form.organization_id.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.organization_id.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    {{ form.slug.label(class="form-label") }} <span class="text-danger">*</span>
                                    {{ form.slug(class="form-control" + (" is-invalid" if form.slug.errors else "")) }}
                                    {% if form.slug.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.slug.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <small class="form-text text-muted">URL-friendly identifier (e.g., "summer-workshop-2024")</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group mb-3">
                                    {{ form.event_type.label(class="form-label") }} <span class="text-danger">*</span>
                                    {{ form.event_type(class="form-select" + (" is-invalid" if form.event_type.errors else "")) }}
                                    {% if form.event_type.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.event_type.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group mb-3">
                                    {{ form.event_status.label(class="form-label") }} <span class="text-danger">*</span>
                                    {{ form.event_status(class="form-select" + (" is-invalid" if form.event_status.errors else "")) }}
                                    {% if form.event_status.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.event_status.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group mb-3">
                                    {{ form.description.label(class="form-label") }}
                                    {{ form.description(class="form-control" + (" is-invalid" if form.description.errors else "")) }}
                                    {% if form.description.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.description.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Event Details -->
                        <h5 class="mb-3 mt-4">Event Details</h5>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group mb-3">
                                    {{ form.event_format.label(class="form-label") }} <span class="text-danger">*</span>
                                    {{ form.event_format(class="form-select" + (" is-invalid" if form.event_format.errors else ""), id="event_format") }}
                                    {% if form.event_format.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.event_format.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group mb-3">
                                    {{ form.start_date.label(class="form-label") }} <span class="text-danger">*</span>
                                    {{ form.start_date(class="form-control" + (" is-invalid" if form.start_date.errors else "")) }}
                                    {% if form.start_date.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.start_date.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group mb-3">
                                    {{ form.duration.label(class="form-label") }}
                                    {{ form.duration(class="form-control" + (" is-invalid" if form.duration.errors else "")) }}
                                    {% if form.duration.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.duration.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <small class="form-text text-muted">Duration in minutes</small>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    {{ form.registration_deadline.label(class="form-label") }}
                                    {{ form.registration_deadline(class="form-control" + (" is-invalid" if form.registration_deadline.errors else "")) }}
                                    {% if form.registration_deadline.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.registration_deadline.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group mb-3">
                                    {{ form.capacity.label(class="form-label") }}
                                    {{ form.capacity(class="form-control" + (" is-invalid" if form.capacity.errors else "")) }}
                                    {% if form.capacity.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.capacity.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group mb-3">
                                    {{ form.cost.label(class="form-label") }}
                                    {{ form.cost(class="form-control" + (" is-invalid" if form.cost.errors else "")) }}
                                    {% if form.cost.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.cost.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Location (for in-person and hybrid) -->
                        <div id="locationSection">
                            <h5 class="mb-3 mt-4">Location</h5>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group mb-3">
                                        {{ form.location_name.label(class="form-label") }}
                                        {{ form.location_name(class="form-control" + (" is-invalid" if form.location_name.errors else "")) }}
                                        {% if form.location_name.errors %}
                                            <div class="invalid-feedback">
                                                {% for error in form.location_name.errors %}
                                                    {{ error }}
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group mb-3">
                                        {{ form.location_address.label(class="form-label") }}
                                        {{ form.location_address(class="form-control" + (" is-invalid" if form.location_address.errors else "")) }}
                                        {% if form.location_address.errors %}
                                            <div class="invalid-feedback">
                                                {% for error in form.location_address.errors %}
                                                    {{ error }}
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Virtual Link (for virtual and hybrid) -->
                        <div id="virtualSection">
                            <h5 class="mb-3 mt-4">Virtual Link</h5>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group mb-3">
                                        {{ form.virtual_link.label(class="form-label") }}
                                        {{ form.virtual_link(class="form-control" + (" is-invalid" if form.virtual_link.errors else "")) }}
                                        {% if form.virtual_link.errors %}
                                            <div class="invalid-feedback">
                                                {% for error in form.virtual_link.errors %}
                                                    {{ error }}
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                        <small class="form-text text-muted">Zoom, Teams, or other virtual meeting link</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cancellation (optional) -->
                        <h5 class="mb-3 mt-4">Additional Information</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    {{ form.cancellation_reason.label(class="form-label") }}
                                    {{ form.cancellation_reason(class="form-select" + (" is-invalid" if form.cancellation_reason.errors else "")) }}
                                    {% if form.cancellation_reason.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.cancellation_reason.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <small class="form-text text-muted">Only required if event is cancelled</small>
                                </div>
                            </div>
                        </div>

                        <hr class="my-4">
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-calendar-plus"></i> Create Event
                            </button>
                            <a href="{{ url_for('events_list') }}" class="btn btn-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Show/hide location and virtual sections based on event format
document.addEventListener('DOMContentLoaded', function() {
    const eventFormat = document.getElementById('event_format');
    const locationSection = document.getElementById('locationSection');
    const virtualSection = document.getElementById('virtualSection');

    function updateSections() {
        const format = eventFormat.value;
        if (format === 'in_person') {
            locationSection.style.display = 'block';
            virtualSection.style.display = 'none';
        } else if (format === 'virtual') {
            locationSection.style.display = 'none';
            virtualSection.style.display = 'block';
        } else if (format === 'hybrid') {
            locationSection.style.display = 'block';
            virtualSection.style.display = 'block';
        }
    }

    // Initial update
    updateSections();

    // Update on change
    eventFormat.addEventListener('change', updateSections);
});
</script>
{% endblock %}
